
redis 数据结构
string list set zset hash

redis是有C语言实现的

string 底层是simple dynamic string，动态字符串，是redis自己实现的数据结构，优点是无需担心内存溢出，常数时间能获取长度，扩容会预分配内存

hash 扩容，会生成一个新的hash表ht[1]，原hash表 ht[0]  渐进式hash+辅助rehash
渐进式hash,每一次操作会将ht[0]的数据迁移到ht[1]中，ht[0]不再新增数据，也就是ht[0]处于不断缩小的状态
辅助rehash，当服务器负载不高的时候，会自动作hash迁移
优点：采取分治的思想实现平滑迁移 缺点：内存使用量变大

只有在没有执行redis持久化的时候，才可以执行扩缩容

持久化
RDB方式比较粗粒度，发生故障时，两次持久化之间的数据会丢失
AOF方式会写磁盘，如果io慢，会阻塞主进程

redis事务
客户端执行multi命令，客户端状态切换，从非事务状态切换到事务状态，不支持嵌套事务

命令入队
如果客户端发送的命令为 EXEC、DISCARD、WATCH、MULTI 四个命令的其中一个，那么服务器立即执行这个命令。
与此相反，如果客户端发送的命令是 EXEC、DISCARD、WATCH、MULTI 四个命令以外的其他命令，那么服务器并不立即执行这个命令。
首先检查此命令的格式是否正确，如果不正确，服务器会在客户端状态（redisClient）的 flags 属性打开 REDIS_MULTI 标识，并且返回错误信息给客户端。
如果正确将这个命令放入一个事务队列里面，然后向客户端返回 QUEUED 回复。

客户端发送 EXEC 命令，服务器执行 EXEC 命令逻辑。

如果客户端状态的 flags 属性不包含 REDIS_MULTI 标识，或者包含 REDIS_DIRTY_CAS 或者 REDIS_DIRTY_EXEC 标识，那么就直接取消事务的执行。
否则客户端处于事务状态（flags 有 REDIS_MULTI 标识），服务器会遍历客户端的事务队列，然后执行事务队列中的所有命令，最后将返回结果全部返回给客户端；



redis事务不支持回滚
Redis事务执行过程中，如果一个命令执行出错，那么就返回错误，然后还是会接着继续执行下面的命令。
